<!DOCTYPE html>
<html>
<head>
  <title>GPS Taxi Meter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
      color: #333;
    }
    h1 {
      font-size: 2.5em;
      color: #fff;
    }
    label {
      display: block;
      margin-top: 15px;
      font-size: 1.2em;
      color: #fff;
    }
    input {
      font-size: 1.2em;
      padding: 5px;
      margin-top: 5px;
      border-radius: 5px;
      border: none;
    }
    #fare {
      font-size: 3em;
      margin: 20px 0;
      color: #28a745;
    }
    button {
      font-size: 1.2em;
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      color: #fff;
      cursor: pointer;
    }
    button.start {
      background-color: #28a745;
    }
    button.stop {
      background-color: #dc3545;
    }
    button.reset {
      background-color: #6c757d;
    }
  </style>
</head>
<body>
  <h1>GPS Taxi Meter</h1>
  <label>Base Fare: $<input type="number" id="baseFare" step="0.1"></label>
  <label>Per km: $<input type="number" id="perKm" value="1" step="0.1"></label>
  <label>Per minute: $<input type="number" id="perMinute" value="0.3" step="0.1"></label>
  <div id="fare">$0.00</div>
  <button class="start" onclick="startMeter()">Start</button>
  <button class="stop" onclick="stopMeter()">Stop</button>
  <button class="reset" onclick="resetMeter()">Reset</button>

  <script>
    let fare = 0;
    let distance = 0;
    let timeMinutes = 0;
    let interval;
    let watching = false;
    let startTime, watchId;
    let lastPosition;

    // Set base fare automatically
    function setBaseFareByTime() {
      const now = new Date();
      const hour = now.getHours();
      let baseFare = 2.0;
      if (hour >= 22 || hour < 5) {
        baseFare = 3.0;
      }
      document.getElementById('baseFare').value = baseFare;
    }

    setBaseFareByTime();

    function startMeter() {
      if (watching) return;
      watching = true;
      fare = parseFloat(document.getElementById('baseFare').value);
      distance = 0;
      timeMinutes = 0;
      startTime = new Date();
      interval = setInterval(updateFare, 60000); // every minute
      if (navigator.geolocation) {
        watchId = navigator.geolocation.watchPosition(updateDistance);
      }
      updateDisplay();
    }

    function updateFare() {
      let perMinute = parseFloat(document.getElementById('perMinute').value);
      fare += perMinute;
      timeMinutes++;
      updateDisplay();
    }

    function updateDistance(position) {
      if (lastPosition) {
        const R = 6371; // km
        const dLat = (position.coords.latitude - lastPosition.latitude) * Math.PI / 180;
        const dLon = (position.coords.longitude - lastPosition.longitude) * Math.PI / 180;
        const lat1 = lastPosition.latitude * Math.PI / 180;
        const lat2 = position.coords.latitude * Math.PI / 180;

        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const d = R * c;

        let perKm = parseFloat(document.getElementById('perKm').value);
        fare += d * perKm;
        distance += d;
        updateDisplay();
      }
      lastPosition = {
        latitude: position.coords.latitude,
        longitude: position.coords.longitude
      };
    }

    function stopMeter() {
      if (!watching) return;
      clearInterval(interval);
      navigator.geolocation.clearWatch(watchId);
      watching = false;
    }

    function resetMeter() {
      stopMeter();
      fare = 0;
      distance = 0;
      timeMinutes = 0;
      document.getElementById('fare').innerText = '$0.00';
      setBaseFareByTime();
    }

    function updateDisplay() {
      document.getElementById('fare').innerText = '$' + fare.toFixed(2);
    }
  </script>
</body>
</html
